"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7022],{7022:(O,A,u)=>{u.r(A),u.d(A,{BotSetupPageModule:()=>_});var f=u(9808),v=u(2382),c=u(877),P=u(9249),d=u(655),t=u(1223),M=u(3),m=u(520),Z=u(6955),y=u(5449);function D(o,h){if(1&o){const e=t.EpF();t.TgZ(0,"div",5)(1,"ion-icon",6),t.NdJ("click",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.onDeleteBot(i))}),t.qZA()()}}function x(o,h){if(1&o&&(t.TgZ(0,"ion-col"),t._uU(1),t.qZA()),2&o){const e=t.oxw(2);t.xp6(1),t.hij("Price 10^",e.leadingZeros," ")}}function N(o,h){1&o&&(t.TgZ(0,"ion-col"),t._uU(1,"Price "),t.qZA())}function B(o,h){if(1&o&&(t.TgZ(0,"ion-row")(1,"ion-col"),t._uU(2),t.ALo(3,"date"),t.qZA(),t.TgZ(4,"ion-col"),t._uU(5),t.qZA(),t.TgZ(6,"ion-col"),t._uU(7),t.qZA()()),2&o){const e=h.$implicit,n=t.oxw(2);t.xp6(2),t.Oqu(t.xi3(3,3,e.D,"dd/MM HH:mm")),t.xp6(3),t.Oqu(n.shortNumberDisplay(e.Q,1,3)),t.xp6(2),t.Oqu(n.shortAmount(e.P))}}function I(o,h){if(1&o){const e=t.EpF();t.TgZ(0,"div")(1,"ion-item",7)(2,"span",0)(3,"ion-chip",8),t.NdJ("click",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.onShowOutput(i))}),t._UZ(4,"ion-icon",9),t.TgZ(5,"ion-label"),t._uU(6,"transactions "),t.qZA(),t._UZ(7,"ion-icon",10),t.qZA()()(),t.TgZ(8,"ion-item")(9,"p"),t._uU(10),t.qZA()(),t.TgZ(11,"ion-grid",11)(12,"ion-row")(13,"ion-col"),t._uU(14,"Date"),t.qZA(),t.TgZ(15,"ion-col"),t._uU(16,"Qty"),t.qZA(),t.YNc(17,x,2,1,"ion-col",4),t.YNc(18,N,2,0,"ion-col",4),t.qZA(),t.YNc(19,B,8,6,"ion-row",12),t.qZA()()}if(2&o){const e=t.oxw();t.xp6(10),t.xDo("Q ",e.shortNumberDisplay(e.dNetQuantity,1,3),", $ ",e.dNetInvestment.toFixed(2),", Avg ",e.dAvgPrice.toFixed(11),", 3% ",e.d3PctPrice.toFixed(11),", 5% ",e.d5PctPrice.toFixed(11),""),t.xp6(7),t.Q6J("ngIf",e.leadingZeros>0),t.xp6(1),t.Q6J("ngIf",e.leadingZeros<=0),t.xp6(1),t.Q6J("ngForOf",e.oT)}}const T=["","K","M","B","T","Q"],C=[{path:"",component:(()=>{class o{constructor(e,n,i,r,l){this.oLocation=e,this.oAPIService=n,this.http=i,this.router=r,this.oStorage=l,this.sKey=void 0,this.sTitle=void 0,this.bLoaded=!1,this.bNew=!0,this.oT=[],this.dNetInvestment=0,this.dNetQuantity=0,this.dAvgPrice=0,this.d3PctPrice=0,this.d5PctPrice=0,this.dMinPrice=0,this.leadingZeros=0,this.oSConfig=this.oLocation.getState(),console.log(this.oSConfig)}onBack(){return(0,d.mG)(this,void 0,void 0,function*(){this.oLocation.back()})}getKey(){return this.oSConfig.PARAMS.EX+"_"+this.oSConfig.PARAMS.SNAME+"_"+this.oSConfig.PARAMS.A+this.oSConfig.PARAMS.B}getTitle(){return this.oSConfig.PARAMS.EX+"_"+this.oSConfig.PARAMS.SNAME}shortAmount(e){return this.leadingZeros<=0?e.toFixed(7).replace(/\.?0+$/,""):(e*Math.pow(10,this.leadingZeros)).toFixed(this.leadingZeros+1)}shortNumberDisplay(e,n,i){if(0===e)return e;const r=Math.floor(Math.log10(Math.abs(e))/3),l=T[r];return(e/Math.pow(10,3*r)).toLocaleString(void 0,{minimumFractionDigits:n,maximumFractionDigits:i})+l}ngOnInit(){void 0!==this.oSConfig.ID?this.oAPIService.send2ServerP("exchange-bot-config/fetch",!0,{ID:this.oSConfig.ID}).then(e=>(0,d.mG)(this,void 0,void 0,function*(){this.oSConfig=e.result[0],console.log(this.oSConfig),this.loadForm()})):this.loadForm()}loadForm(){this.http.get("/assets/strategy-"+this.oSConfig.PARAMS.SNAME+".json").subscribe(e=>(0,d.mG)(this,void 0,void 0,function*(){this.formData=e,this.updateValues(this.oSConfig),this.sTitle=this.getTitle()}))}updateValues(e){if(void 0===e||null==e||null==this.formData||this.bLoaded)return;this.bLoaded=!0;let n=e.PARAMS,i=this.formData.controls.length,r=Object.keys(n);var l=["PARAMS.SNAME","PARAMS.EX"];this.oSConfig.isNew||(l.push("PARAMS.A"),l.push("PARAMS.B"));for(var s=0;s<r.length;s++){let g=r[s];for(let a=0;a<i;a++)this.formData.controls[a].name=="PARAMS."+g&&(this.formData.controls[a].value=n[g]),this.formData.controls[a].readonly=!!l.includes(this.formData.controls[a].name)}}onDeleteBot(e){return(0,d.mG)(this,void 0,void 0,function*(){yield this.oAPIService.send2ServerP("exchange-bot-config/delete",!0,{ID:this.oSConfig.ID}).then(n=>(0,d.mG)(this,void 0,void 0,function*(){yield this.router.navigateByUrl("bot-list")}))})}onDeleteOutput(e){return(0,d.mG)(this,void 0,void 0,function*(){yield this.oAPIService.send2ServerPDelete("output/"+e.ID)})}getDecimalPlaces(e){const n=String(e);return n.includes(".")?n.split(".")[1].length:0}onShowOutput(e){return(0,d.mG)(this,void 0,void 0,function*(){this.oT=[],this.dMinPrice=Number.MAX_VALUE;let n=yield this.normalizeData(e);yield this.oAPIService.send2ServerP("open-orders",!0,{EX:n.PARAMS.EX,SNAME:n.PARAMS.SNAME,A:n.PARAMS.A,B:n.PARAMS.B}).then(i=>(0,d.mG)(this,void 0,void 0,function*(){if(console.log(i),void 0===i||void 0===i.result)return;let r=i.result.length;this.dNetInvestment=0,this.dNetQuantity=0;for(var s=0;s<r;s++){if("FILLED"!=i.result[s].Status)continue;let b=i.result[s].D,S=this.getDecimalPlaces(i.result[s].Q),p=this.getDecimalPlaces(i.result[s].P);S=p<3?Math.min(S+p,7):Math.min(S,0),this.dMinPrice=Math.min(i.result[s].P),"S"==i.result[s].Dir?(i.result[s].Q=-1*i.result[s].Q,this.dNetInvestment+=i.result[s].P*i.result[s].Q*.998):this.dNetInvestment+=i.result[s].P*i.result[s].Q*1.002,this.dNetQuantity+=i.result[s].Q,this.oT.push({D:b,Q:i.result[s].Q.toFixed(S),P:i.result[s].P,$:Number(i.result[s].Q)*Number(i.result[s].P)})}if((""+this.dMinPrice).split("."),this.dMinPrice>=1e-4)this.leadingZeros=0;else{var a=this.dMinPrice.toFixed(18).replace(/\.?0+$/,"");this.leadingZeros=a.substring(0,a.lastIndexOf("0")+1).length-2,this.leadingZeros<3?this.leadingZeros=0:this.leadingZeros-=2}0!=this.dNetQuantity&&(this.dAvgPrice=this.dNetInvestment/this.dNetQuantity),this.dNetQuantity<0?(this.d3PctPrice=.97*this.dAvgPrice,this.d5PctPrice=.95*this.dAvgPrice):(this.d3PctPrice=1.03*this.dAvgPrice,this.d5PctPrice=1.05*this.dAvgPrice)}))})}normalizeData(e){let n=Object.keys(e),i=n.length,r=JSON.parse(JSON.stringify(this.oSConfig));for(var l=0;l<i;l++){var s=n[l],g=e[s];s.startsWith("PARAMS")?r.PARAMS[s.substring(7)]=g:r[s]=g}return r}onFormSubmit(e){return(0,d.mG)(this,void 0,void 0,function*(){this.bLoaded=!0;let n=Object.keys(e),i=n.length;for(var r=0;r<i;r++){var l=n[r],s=e[l];l.startsWith("PARAMS")&&(this.oSConfig.PARAMS[l.substring(7)]=s)}void 0===this.oSConfig.ID?yield this.oAPIService.send2ServerP("exchange-bot-config/insert",!0,{PARAMS:JSON.stringify(this.oSConfig.PARAMS)}):yield this.oAPIService.send2ServerP("exchange-bot-config/update",!0,{ID:this.oSConfig.ID,PARAMS:JSON.stringify(this.oSConfig.PARAMS)}),yield this.router.navigateByUrl("bot-list")})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(f.Ye),t.Y36(M.D),t.Y36(m.eN),t.Y36(P.F0),t.Y36(Z.V))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-bot-setup"]],decls:11,vars:4,consts:[["slot","start"],["slot","end",4,"ngIf"],[1,"ion-padding"],[3,"jsonFormData","formSubmission"],[4,"ngIf"],["slot","end"],["name","trash",3,"click"],["item-end",""],[3,"click"],["name","albums","color","primary"],["color","primary"],[1,"ion-margin"],[4,"ngFor","ngForOf"]],template:function(e,n){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t._uU(3),t.qZA(),t.TgZ(4,"ion-buttons",0),t._UZ(5,"ion-back-button"),t.qZA(),t.YNc(6,D,2,0,"div",1),t.qZA()(),t.TgZ(7,"ion-content",2)(8,"div")(9,"app-json-form",3),t.NdJ("formSubmission",function(r){return n.onFormSubmit(r)}),t.qZA()(),t.YNc(10,I,20,8,"div",4),t.qZA()),2&e&&(t.xp6(3),t.Oqu(n.sTitle),t.xp6(3),t.Q6J("ngIf",void 0!==n.oSConfig.ID),t.xp6(3),t.Q6J("jsonFormData",n.formData),t.xp6(1),t.Q6J("ngIf",!n.oSConfig.isNew))},dependencies:[f.sg,f.O5,c.oU,c.Sm,c.hM,c.wI,c.W2,c.jY,c.Gu,c.gu,c.Ie,c.Q$,c.Nd,c.sr,c.wd,c.cs,y.u,f.uU],styles:["ion-col[_ngcontent-%COMP%]{text-align:right}ion-icon[_ngcontent-%COMP%]{margin:10px;font-size:large}"]}),o})()}];let R=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[P.Bz.forChild(C),P.Bz]}),o})();var Q=u(5441);let _=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[f.ez,v.UX,c.Pc,R,m.JF,Q.G]}),o})()}}]);