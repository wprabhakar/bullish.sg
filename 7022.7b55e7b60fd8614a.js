"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7022],{7022:(F,m,c)=>{c.r(m),c.d(m,{BotSetupPageModule:()=>b});var f=c(9808),v=c(2382),u=c(877),S=c(9249),g=c(655),t=c(1223),M=c(3),P=c(520),Z=c(6955),y=c(5449);function x(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"div",5)(1,"ion-icon",6),t.NdJ("click",function(o){t.CHM(e);const r=t.oxw();return t.KtG(r.onDeleteBot(o))}),t.qZA()()}}function I(n,a){if(1&n&&(t.TgZ(0,"ion-col"),t._uU(1),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.hij("Price 10^",e.leadingZeros," ")}}function T(n,a){1&n&&(t.TgZ(0,"ion-col"),t._uU(1,"Price "),t.qZA())}function D(n,a){if(1&n&&(t.TgZ(0,"ion-row")(1,"ion-col"),t._uU(2),t.ALo(3,"date"),t.qZA(),t.TgZ(4,"ion-col"),t._uU(5),t.qZA(),t.TgZ(6,"ion-col"),t._uU(7),t.qZA()()),2&n){const e=a.$implicit,i=t.oxw(2);t.xp6(2),t.Oqu(t.xi3(3,3,e.D,"dd/MM HH:mm")),t.xp6(3),t.Oqu(i.shortNumberDisplay(e.Q,1,3)),t.xp6(2),t.Oqu(i.shortAmount(e.AVGPRICE))}}function R(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"div")(1,"ion-item",7)(2,"ion-label",8),t._uU(3),t.qZA(),t.TgZ(4,"span",5)(5,"ion-chip",9),t.NdJ("click",function(o){t.CHM(e);const r=t.oxw();return t.KtG(r.onShowOutput(o))}),t._UZ(6,"ion-icon",10),t.TgZ(7,"ion-label",11),t._uU(8,"transactions"),t.qZA(),t._UZ(9,"ion-icon",12),t.qZA()()(),t.TgZ(10,"ion-item",13)(11,"ion-label",8),t._uU(12),t.qZA(),t.TgZ(13,"ion-label",11),t._uU(14),t.qZA()(),t.TgZ(15,"ion-item",13)(16,"ion-label",14),t._uU(17),t.qZA(),t.TgZ(18,"ion-label",15),t._uU(19),t.qZA()(),t.TgZ(20,"ion-item",13)(21,"ion-label",14),t._uU(22),t.qZA(),t.TgZ(23,"ion-label",15),t._uU(24),t.qZA()(),t.TgZ(25,"ion-grid",16)(26,"ion-row")(27,"ion-col"),t._uU(28,"Date"),t.qZA(),t.TgZ(29,"ion-col"),t._uU(30,"Qty"),t.qZA(),t.YNc(31,I,2,1,"ion-col",4),t.YNc(32,T,2,0,"ion-col",4),t.qZA(),t.YNc(33,D,8,6,"ion-row",17),t.qZA()()}if(2&n){const e=t.oxw();t.xp6(3),t.AsE("Q ",e.shortNumberDisplay(e.dNetQuantity,1,3)," $ ",e.dNetInvestment.toFixed(2),""),t.xp6(9),t.hij("Price 10^",e.leadingZeros,""),t.xp6(2),t.hij("AvgPrice ",e.shortAmount(e.dAvgPrice),""),t.xp6(3),t.hij("3% ",e.shortAmount(e.getPrice(e.dAvgPrice,.03)),""),t.xp6(2),t.hij("5% ",e.shortAmount(e.getPrice(e.dAvgPrice,.05)),""),t.xp6(3),t.hij("10% ",e.shortAmount(e.getPrice(e.dAvgPrice,.1)),""),t.xp6(2),t.hij("15% ",e.shortAmount(e.getPrice(e.dAvgPrice,.15)),""),t.xp6(7),t.Q6J("ngIf",e.leadingZeros>0),t.xp6(1),t.Q6J("ngIf",e.leadingZeros<=0),t.xp6(1),t.Q6J("ngForOf",e.oT)}}const C=["","K","M","B","T","Q"],N=[{path:"",component:(()=>{class n{constructor(e,i,o,r,l){this.oLocation=e,this.oAPIService=i,this.http=o,this.router=r,this.oStorage=l,this.sKey=void 0,this.sTitle=void 0,this.bLoaded=!1,this.bNew=!0,this.oT=[],this.dNetInvestment=0,this.dNetQuantity=0,this.dAvgPrice=0,this.dMinPrice=0,this.leadingZeros=0,this.oSConfig=this.oLocation.getState()}onBack(){return(0,g.mG)(this,void 0,void 0,function*(){this.oLocation.back()})}getKey(){return this.oSConfig.PARAMS.EX+"_"+this.oSConfig.PARAMS.SNAME+"_"+this.oSConfig.PARAMS.A+this.oSConfig.PARAMS.B}getTitle(){return this.oSConfig.PARAMS.EX+"_"+this.oSConfig.PARAMS.SNAME}shortAmount(e){return this.leadingZeros<=0?(+e).toFixed(7).replace(/\.?0+$/,""):(e*Math.pow(10,this.leadingZeros)).toFixed(this.leadingZeros+1)}shortNumberDisplay(e,i,o){if(0===e)return e;const r=Math.floor(Math.log10(Math.abs(e))/3);console.log(r);var l=C[r];return null==l&&(l=""+r),(e/Math.pow(10,3*r)).toLocaleString(void 0,{minimumFractionDigits:i,maximumFractionDigits:o})+l}ngOnInit(){void 0!==this.oSConfig.ID?this.oAPIService.send2ServerP("exchange-bot-config/fetch",!0,{ID:this.oSConfig.ID}).then(e=>(0,g.mG)(this,void 0,void 0,function*(){this.oSConfig=e.result[0],this.loadForm()})):this.loadForm()}loadForm(){this.http.get("/assets/strategy-"+this.oSConfig.PARAMS.SNAME+".json").subscribe(e=>(0,g.mG)(this,void 0,void 0,function*(){this.formData=e,this.updateValues(this.oSConfig),this.sTitle=this.getTitle()}))}updateValues(e){if(void 0===e||null==e||null==this.formData||this.bLoaded)return;this.bLoaded=!0;let i=e.PARAMS,o=this.formData.controls.length,r=Object.keys(i);var l=["PARAMS.SNAME","PARAMS.EX"];this.oSConfig.isNew||(l.push("PARAMS.A"),l.push("PARAMS.B"));for(var s=0;s<r.length;s++){let d=r[s];for(let h=0;h<o;h++)this.formData.controls[h].name=="PARAMS."+d&&(this.formData.controls[h].value=i[d]),this.formData.controls[h].readonly=!!l.includes(this.formData.controls[h].name)}}onDeleteBot(e){return(0,g.mG)(this,void 0,void 0,function*(){yield this.oAPIService.send2ServerP("exchange-bot-config/delete",!0,{ID:this.oSConfig.ID}).then(i=>(0,g.mG)(this,void 0,void 0,function*(){yield this.router.navigateByUrl("bot-list")}))})}onDeleteOutput(e){return(0,g.mG)(this,void 0,void 0,function*(){yield this.oAPIService.send2ServerPDelete("output/"+e.ID)})}getDecimalPlaces(e){const i=String(e);return i.includes(".")?i.split(".")[1].length:0}onShowOutput(e){return(0,g.mG)(this,void 0,void 0,function*(){this.oT=[],this.dMinPrice=Number.MAX_VALUE;let i=yield this.normalizeData(e);yield this.oAPIService.send2ServerP("open-orders",!0,{EX:i.PARAMS.EX,SNAME:i.PARAMS.SNAME,A:i.PARAMS.A,B:i.PARAMS.B}).then(o=>(0,g.mG)(this,void 0,void 0,function*(){if(void 0===o||void 0===o.result)return;let r=o.result.length;this.dNetInvestment=0,this.dNetQuantity=0;for(var s=0;s<r;s++){if("FILLED"!=o.result[s].STATUS)continue;let Q=o.result[s].T,A=this.getDecimalPlaces(o.result[s].FQ),p=this.getDecimalPlaces(o.result[s].AVGPRICE);A=p<3?Math.min(A+p,7):Math.min(A,0),this.dMinPrice=Math.min(this.dMinPrice,+o.result[s].AVGPRICE),"S"==o.result[s].SIDE?(o.result[s].FQ=-1*+o.result[s].FQ,this.dNetInvestment+=+o.result[s].AVGPRICE*+o.result[s].FQ*.998):this.dNetInvestment+=+o.result[s].AVGPRICE*+o.result[s].FQ*1.002,this.dNetQuantity+=+o.result[s].FQ,this.oT.push({D:Q,Q:o.result[s].FQ,AVGPRICE:+o.result[s].AVGPRICE,$:+o.result[s].FQ*+o.result[s].AVGPRICE})}if((""+this.dMinPrice).split("."),this.dMinPrice>=1e-4)this.leadingZeros=0;else{var h=this.dMinPrice.toFixed(18).replace(/\.?0+$/,"");this.leadingZeros=h.substring(0,h.lastIndexOf("0")+1).length-2,this.leadingZeros<3?this.leadingZeros=0:this.leadingZeros-=2}0!=this.dNetQuantity&&(this.dAvgPrice=this.dNetInvestment/this.dNetQuantity)}))})}getPrice(e,i){return 0==this.dNetQuantity?0:this.dNetQuantity<0?e/(1+i):e*(1+i)}normalizeData(e){let i=Object.keys(e),o=i.length,r=JSON.parse(JSON.stringify(this.oSConfig));for(var l=0;l<o;l++){var s=i[l],d=e[s];s.startsWith("PARAMS")?r.PARAMS[s.substring(7)]=d:r[s]=d}return r}onFormSubmit(e){return(0,g.mG)(this,void 0,void 0,function*(){this.bLoaded=!0;let i=Object.keys(e),o=i.length;for(var r=0;r<o;r++){var l=i[r],s=e[l];l.startsWith("PARAMS")&&(this.oSConfig.PARAMS[l.substring(7)]=s)}void 0===this.oSConfig.ID?yield this.oAPIService.send2ServerP("exchange-bot-config/insert",!0,{PARAMS:JSON.stringify(this.oSConfig.PARAMS)}):yield this.oAPIService.send2ServerP("exchange-bot-config/update",!0,{ID:this.oSConfig.ID,PARAMS:JSON.stringify(this.oSConfig.PARAMS)}),yield this.router.navigateByUrl("bot-list")})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(f.Ye),t.Y36(M.D),t.Y36(P.eN),t.Y36(S.F0),t.Y36(Z.V))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-bot-setup"]],decls:11,vars:4,consts:[["slot","start"],["slot","end",4,"ngIf"],[1,"ion-padding"],[3,"jsonFormData","formSubmission"],[4,"ngIf"],["slot","end"],["name","trash",3,"click"],["item-end",""],[1,"ion-text-left"],[3,"click"],["name","albums","color","primary"],[1,"ion-text-right"],["color","primary"],[1,"ion-no-padding"],[1,"ion-text-left","ion-no-padding"],[1,"ion-text-right","ion-no-padding"],[1,"ion-margin"],[4,"ngFor","ngForOf"]],template:function(e,i){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t._uU(3),t.qZA(),t.TgZ(4,"ion-buttons",0),t._UZ(5,"ion-back-button"),t.qZA(),t.YNc(6,x,2,0,"div",1),t.qZA()(),t.TgZ(7,"ion-content",2)(8,"div")(9,"app-json-form",3),t.NdJ("formSubmission",function(r){return i.onFormSubmit(r)}),t.qZA()(),t.YNc(10,R,34,11,"div",4),t.qZA()),2&e&&(t.xp6(3),t.Oqu(i.sTitle),t.xp6(3),t.Q6J("ngIf",void 0!==i.oSConfig.ID),t.xp6(3),t.Q6J("jsonFormData",i.formData),t.xp6(1),t.Q6J("ngIf",!i.oSConfig.isNew))},dependencies:[f.sg,f.O5,u.oU,u.Sm,u.hM,u.wI,u.W2,u.jY,u.Gu,u.gu,u.Ie,u.Q$,u.Nd,u.sr,u.wd,u.cs,y.u,f.uU],styles:["ion-col[_ngcontent-%COMP%]{text-align:right}ion-icon[_ngcontent-%COMP%]{margin:10px;font-size:large}"]}),n})()}];let B=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[S.Bz.forChild(N),S.Bz]}),n})();var _=c(5441);let b=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[f.ez,v.UX,u.Pc,B,P.JF,_.G]}),n})()}}]);