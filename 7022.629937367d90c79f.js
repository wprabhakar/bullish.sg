"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7022],{7022:(O,A,u)=>{u.r(A),u.d(A,{BotSetupPageModule:()=>_});var f=u(9808),v=u(2382),l=u(877),P=u(9249),d=u(655),t=u(1223),M=u(3),m=u(520),T=u(6955),Z=u(5449);function y(n,h){if(1&n){const i=t.EpF();t.TgZ(0,"div",5)(1,"ion-icon",6),t.NdJ("click",function(e){t.CHM(i);const r=t.oxw();return t.KtG(r.onDeleteBot(e))}),t.qZA()()}}function D(n,h){if(1&n&&(t.TgZ(0,"ion-col"),t._uU(1),t.qZA()),2&n){const i=t.oxw(2);t.xp6(1),t.hij("Price 10^",i.leadingZeros," ")}}function x(n,h){1&n&&(t.TgZ(0,"ion-col"),t._uU(1,"Price "),t.qZA())}function N(n,h){if(1&n&&(t.TgZ(0,"ion-row")(1,"ion-col"),t._uU(2),t.ALo(3,"date"),t.qZA(),t.TgZ(4,"ion-col"),t._uU(5),t.qZA(),t.TgZ(6,"ion-col"),t._uU(7),t.qZA()()),2&n){const i=h.$implicit,o=t.oxw(2);t.xp6(2),t.Oqu(t.xi3(3,3,i.D,"dd/MM HH:mm")),t.xp6(3),t.Oqu(o.shortNumberDisplay(i.Q,1,3)),t.xp6(2),t.Oqu(o.shortAmount(i.P))}}function B(n,h){if(1&n){const i=t.EpF();t.TgZ(0,"div")(1,"ion-item",7)(2,"span",0)(3,"ion-chip",8),t.NdJ("click",function(e){t.CHM(i);const r=t.oxw();return t.KtG(r.onShowOutput(e))}),t._UZ(4,"ion-icon",9),t.TgZ(5,"ion-label"),t._uU(6,"transactions "),t.qZA(),t._UZ(7,"ion-icon",10),t.qZA()()(),t.TgZ(8,"ion-item")(9,"p"),t._uU(10),t.qZA()(),t.TgZ(11,"ion-grid",11)(12,"ion-row")(13,"ion-col"),t._uU(14,"Date"),t.qZA(),t.TgZ(15,"ion-col"),t._uU(16,"Qty"),t.qZA(),t.YNc(17,D,2,1,"ion-col",4),t.YNc(18,x,2,0,"ion-col",4),t.qZA(),t.YNc(19,N,8,6,"ion-row",12),t.qZA()()}if(2&n){const i=t.oxw();t.xp6(10),t.xDo("Q ",i.shortNumberDisplay(i.dNetQuantity,1,3),", $ ",i.dNetInvestment.toFixed(2),", Avg ",i.dAvgPrice.toFixed(11),", 3% ",i.d3PctPrice.toFixed(11),", 5% ",i.d5PctPrice.toFixed(11),""),t.xp6(7),t.Q6J("ngIf",i.leadingZeros>0),t.xp6(1),t.Q6J("ngIf",i.leadingZeros<=0),t.xp6(1),t.Q6J("ngForOf",i.oT)}}const I=["","K","M","B","T","Q"],C=[{path:"",component:(()=>{class n{constructor(i,o,e,r,c){this.oLocation=i,this.oAPIService=o,this.http=e,this.router=r,this.oStorage=c,this.sKey=void 0,this.sTitle=void 0,this.bLoaded=!1,this.bNew=!0,this.oT=[],this.dNetInvestment=0,this.dNetQuantity=0,this.dAvgPrice=0,this.d3PctPrice=0,this.d5PctPrice=0,this.dMinPrice=0,this.leadingZeros=0,this.oSConfig=this.oLocation.getState(),console.log(this.oSConfig)}onBack(){return(0,d.mG)(this,void 0,void 0,function*(){this.oLocation.back()})}getKey(){return this.oSConfig.PARAMS.EX+"_"+this.oSConfig.PARAMS.SNAME+"_"+this.oSConfig.PARAMS.A+this.oSConfig.PARAMS.B}getTitle(){return this.oSConfig.PARAMS.EX+"_"+this.oSConfig.PARAMS.SNAME}shortAmount(i){return this.leadingZeros<=0?i.toFixed(7).replace(/\.?0+$/,""):(i*Math.pow(10,this.leadingZeros)).toFixed(this.leadingZeros+1)}shortNumberDisplay(i,o,e){if(0===i)return i;const r=Math.floor(Math.log10(Math.abs(i))/3),c=I[r];return(i/Math.pow(10,3*r)).toLocaleString(void 0,{minimumFractionDigits:o,maximumFractionDigits:e})+c}ngOnInit(){void 0!==this.oSConfig.ID?this.oAPIService.send2ServerP("exchange-bot-config/fetch",!0,{ID:this.oSConfig.ID}).then(i=>(0,d.mG)(this,void 0,void 0,function*(){this.oSConfig=i.result[0],console.log(this.oSConfig),this.loadForm()})):this.loadForm()}loadForm(){this.http.get("/assets/strategy-"+this.oSConfig.PARAMS.SNAME+".json").subscribe(i=>(0,d.mG)(this,void 0,void 0,function*(){this.formData=i,this.updateValues(this.oSConfig),this.sTitle=this.getTitle()}))}updateValues(i){if(void 0===i||null==i||null==this.formData||this.bLoaded)return;this.bLoaded=!0;let o=i.PARAMS,e=this.formData.controls.length,r=Object.keys(o);var c=["PARAMS.SNAME","PARAMS.EX"];this.oSConfig.isNew||(c.push("PARAMS.A"),c.push("PARAMS.B"));for(var s=0;s<r.length;s++){let g=r[s];for(let a=0;a<e;a++)this.formData.controls[a].name=="PARAMS."+g&&(this.formData.controls[a].value=o[g]),this.formData.controls[a].readonly=!!c.includes(this.formData.controls[a].name)}}onDeleteBot(i){return(0,d.mG)(this,void 0,void 0,function*(){yield this.oAPIService.send2ServerP("exchange-bot-config/delete",!0,{ID:this.oSConfig.ID}).then(o=>(0,d.mG)(this,void 0,void 0,function*(){yield this.router.navigateByUrl("bot-list")}))})}onDeleteOutput(i){return(0,d.mG)(this,void 0,void 0,function*(){yield this.oAPIService.send2ServerPDelete("output/"+i.ID)})}getDecimalPlaces(i){const o=String(i);return o.includes(".")?o.split(".")[1].length:0}onShowOutput(i){return(0,d.mG)(this,void 0,void 0,function*(){this.oT=[],this.dMinPrice=Number.MAX_VALUE;let o=yield this.normalizeData(i);console.log(o),yield this.oAPIService.send2ServerP("open-orders",!0,{EX:o.PARAMS.EX,SNAME:o.PARAMS.SNAME,A:o.PARAMS.A,B:o.PARAMS.B}).then(e=>(0,d.mG)(this,void 0,void 0,function*(){if(void 0===e||void 0===e.T)return;let r=e.T.length;this.dNetInvestment=0,this.dNetQuantity=0;for(var s=0;s<r;s++){if("FILLED"!=e.T[s].Status)continue;let b=e.T[s].D,S=this.getDecimalPlaces(e.T[s].Q),p=this.getDecimalPlaces(e.T[s].P);S=p<3?Math.min(S+p,7):Math.min(S,0),this.dMinPrice=Math.min(e.T[s].P),"S"==e.T[s].Dir?(e.T[s].Q=-1*e.T[s].Q,this.dNetInvestment+=e.T[s].P*e.T[s].Q*.998):this.dNetInvestment+=e.T[s].P*e.T[s].Q*1.002,this.dNetQuantity+=e.T[s].Q,this.oT.push({D:b,Q:e.T[s].Q.toFixed(S),P:e.T[s].P,$:Number(e.T[s].Q)*Number(e.T[s].P)})}if((""+this.dMinPrice).split("."),this.dMinPrice>=1e-4)this.leadingZeros=0;else{var a=this.dMinPrice.toFixed(18).replace(/\.?0+$/,"");this.leadingZeros=a.substring(0,a.lastIndexOf("0")+1).length-2,this.leadingZeros<3?this.leadingZeros=0:this.leadingZeros-=2}0!=this.dNetQuantity&&(this.dAvgPrice=this.dNetInvestment/this.dNetQuantity),this.dNetQuantity<0?(this.d3PctPrice=.97*this.dAvgPrice,this.d5PctPrice=.95*this.dAvgPrice):(this.d3PctPrice=1.03*this.dAvgPrice,this.d5PctPrice=1.05*this.dAvgPrice)}))})}normalizeData(i){let o=Object.keys(i),e=o.length,r=JSON.parse(JSON.stringify(this.oSConfig));for(var c=0;c<e;c++){var s=o[c],g=i[s];s.startsWith("PARAMS")?r.PARAMS[s.substring(7)]=g:r[s]=g}return r}onFormSubmit(i){return(0,d.mG)(this,void 0,void 0,function*(){this.bLoaded=!0;let o=Object.keys(i),e=o.length;for(var r=0;r<e;r++){var c=o[r],s=i[c];c.startsWith("PARAMS")&&(this.oSConfig.PARAMS[c.substring(7)]=s)}void 0===this.oSConfig.ID?yield this.oAPIService.send2ServerP("exchange-bot-config/insert",!0,{PARAMS:JSON.stringify(this.oSConfig.PARAMS)}):yield this.oAPIService.send2ServerP("exchange-bot-config/update",!0,{ID:this.oSConfig.ID,PARAMS:JSON.stringify(this.oSConfig.PARAMS)}),yield this.router.navigateByUrl("bot-list")})}}return n.\u0275fac=function(i){return new(i||n)(t.Y36(f.Ye),t.Y36(M.D),t.Y36(m.eN),t.Y36(P.F0),t.Y36(T.V))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-bot-setup"]],decls:11,vars:4,consts:[["slot","start"],["slot","end",4,"ngIf"],[1,"ion-padding"],[3,"jsonFormData","formSubmission"],[4,"ngIf"],["slot","end"],["name","trash",3,"click"],["item-end",""],[3,"click"],["name","albums","color","primary"],["color","primary"],[1,"ion-margin"],[4,"ngFor","ngForOf"]],template:function(i,o){1&i&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t._uU(3),t.qZA(),t.TgZ(4,"ion-buttons",0),t._UZ(5,"ion-back-button"),t.qZA(),t.YNc(6,y,2,0,"div",1),t.qZA()(),t.TgZ(7,"ion-content",2)(8,"div")(9,"app-json-form",3),t.NdJ("formSubmission",function(r){return o.onFormSubmit(r)}),t.qZA()(),t.YNc(10,B,20,8,"div",4),t.qZA()),2&i&&(t.xp6(3),t.Oqu(o.sTitle),t.xp6(3),t.Q6J("ngIf",void 0!==o.oSConfig.ID),t.xp6(3),t.Q6J("jsonFormData",o.formData),t.xp6(1),t.Q6J("ngIf",!o.oSConfig.isNew))},dependencies:[f.sg,f.O5,l.oU,l.Sm,l.hM,l.wI,l.W2,l.jY,l.Gu,l.gu,l.Ie,l.Q$,l.Nd,l.sr,l.wd,l.cs,Z.u,f.uU],styles:["ion-col[_ngcontent-%COMP%]{text-align:right}ion-icon[_ngcontent-%COMP%]{margin:10px;font-size:large}"]}),n})()}];let R=(()=>{class n{}return n.\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[P.Bz.forChild(C),P.Bz]}),n})();var Q=u(5441);let _=(()=>{class n{}return n.\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[f.ez,v.UX,l.Pc,R,m.JF,Q.G]}),n})()}}]);