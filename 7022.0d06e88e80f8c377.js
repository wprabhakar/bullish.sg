"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7022],{7022:(F,P,l)=>{l.r(P),l.d(P,{BotSetupPageModule:()=>b});var f=l(9808),v=l(2382),c=l(877),m=l(9249),h=l(655),t=l(1223),M=l(3),p=l(520),T=l(6955),Z=l(5449);function x(o,u){if(1&o){const i=t.EpF();t.TgZ(0,"div",5)(1,"ion-icon",6),t.NdJ("click",function(r){t.CHM(i);const s=t.oxw();return t.KtG(s.onDeleteBot(r))}),t.qZA()()}}function y(o,u){if(1&o&&(t.TgZ(0,"ion-col"),t._uU(1),t.qZA()),2&o){const i=t.oxw(2);t.xp6(1),t.hij("Price 10^",i.leadingZeros," ")}}function D(o,u){1&o&&(t.TgZ(0,"ion-col"),t._uU(1,"Price "),t.qZA())}function N(o,u){if(1&o&&(t.TgZ(0,"ion-row")(1,"ion-col"),t._uU(2),t.ALo(3,"date"),t.qZA(),t.TgZ(4,"ion-col"),t._uU(5),t.qZA(),t.TgZ(6,"ion-col"),t._uU(7),t.qZA()()),2&o){const i=u.$implicit,e=t.oxw(2);t.xp6(2),t.Oqu(t.xi3(3,3,i.D,"dd/MM HH:mm")),t.xp6(3),t.Oqu(e.shortNumberDisplay(i.Q,1,3)),t.xp6(2),t.Oqu(e.shortAmount(i.P))}}function _(o,u){if(1&o){const i=t.EpF();t.TgZ(0,"div")(1,"ion-item",7)(2,"span",0)(3,"ion-chip",8),t.NdJ("click",function(r){t.CHM(i);const s=t.oxw();return t.KtG(s.onShowOutput(r))}),t._UZ(4,"ion-icon",9),t.TgZ(5,"ion-label"),t._uU(6,"transactions "),t.qZA(),t._UZ(7,"ion-icon",10),t.qZA()(),t.TgZ(8,"span",5)(9,"ion-chip",8),t.NdJ("click",function(r){t.CHM(i);const s=t.oxw();return t.KtG(s.onDeleteOutput(r))}),t._UZ(10,"ion-icon",11),t.TgZ(11,"ion-label"),t._uU(12,"init bot "),t.qZA(),t._UZ(13,"ion-icon",10),t.qZA()()(),t.TgZ(14,"ion-item")(15,"p"),t._uU(16),t.qZA()(),t.TgZ(17,"ion-grid",12)(18,"ion-row")(19,"ion-col"),t._uU(20,"Date"),t.qZA(),t.TgZ(21,"ion-col"),t._uU(22,"Qty"),t.qZA(),t.YNc(23,y,2,1,"ion-col",4),t.YNc(24,D,2,0,"ion-col",4),t.qZA(),t.YNc(25,N,8,6,"ion-row",13),t.qZA()()}if(2&o){const i=t.oxw();t.xp6(16),t.xDo("Q ",i.shortNumberDisplay(i.dNetQuantity,1,3),", $ ",i.dNetInvestment.toFixed(2),", Avg ",i.dAvgPrice.toFixed(11),", 3% ",i.d3PctPrice.toFixed(11),", 5% ",i.d5PctPrice.toFixed(11),""),t.xp6(7),t.Q6J("ngIf",i.leadingZeros>0),t.xp6(1),t.Q6J("ngIf",i.leadingZeros<=0),t.xp6(1),t.Q6J("ngForOf",i.oT)}}const C=["","K","M","B","T","Q"],I=[{path:"",component:(()=>{class o{constructor(i,e,r,s,n){this.oLocation=i,this.oAPIService=e,this.http=r,this.router=s,this.oStorage=n,this.sKey=void 0,this.sTitle=void 0,this.bLoaded=!1,this.bNew=!0,this.oT=[],this.dNetInvestment=0,this.dNetQuantity=0,this.dAvgPrice=0,this.d3PctPrice=0,this.d5PctPrice=0,this.dMinPrice=0,this.leadingZeros=0,this.oSConfig=this.oLocation.getState(),console.log(this.oSConfig),this.sTitle=this.getTitle()}onBack(){return(0,h.mG)(this,void 0,void 0,function*(){this.oLocation.back()})}getKey(){return this.oSConfig.EX+"_"+this.oSConfig.SNAME+"_"+this.oSConfig.A+this.oSConfig.B}getTitle(){return this.oSConfig.EX+"_"+this.oSConfig.SNAME}shortAmount(i){return this.leadingZeros<=0?i.toFixed(7).replace(/\.?0+$/,""):(i*Math.pow(10,this.leadingZeros)).toFixed(this.leadingZeros+1)}shortNumberDisplay(i,e,r){if(0===i)return i;const s=Math.floor(Math.log10(Math.abs(i))/3),n=C[s];return(i/Math.pow(10,3*s)).toLocaleString(void 0,{minimumFractionDigits:e,maximumFractionDigits:r})+n}ngOnInit(){void 0!==this.oSConfig.ID?this.oAPIService.send2ServerP("exchange-bot-config/fetch",!0,{ID:this.oSConfig.ID}).then(i=>(0,h.mG)(this,void 0,void 0,function*(){this.oSConfig=i.result[0],this.loadForm()})):(void 0===this.oSConfig.PARAMS&&(this.oSConfig.PARAMS={}),this.oSConfig.PARAMS.SNAME=this.oSConfig.SNAME,this.oSConfig.PARAMS.EX=this.oSConfig.EX,this.loadForm())}loadForm(){this.http.get("/assets/strategy-"+this.oSConfig.PARAMS.SNAME+".json").subscribe(i=>(0,h.mG)(this,void 0,void 0,function*(){this.formData=i,this.updateValues(this.oSConfig)}))}updateValues(i){if(void 0===i||null==i||null==this.formData||this.bLoaded)return;this.bLoaded=!0;let e=i.PARAMS,r=this.formData.controls.length,s=Object.keys(e);var n=["PARAMS.SNAME","PARAMS.EX"];this.oSConfig.isNew||(n.push("PARAMS.A"),n.push("PARAMS.B"));for(var a=0;a<s.length;a++){let g=s[a];for(let d=0;d<r;d++)this.formData.controls[d].name=="PARAMS."+g&&(this.formData.controls[d].value=e[g]),this.formData.controls[d].readonly=!!n.includes(this.formData.controls[d].name)}}onDeleteBot(i){return(0,h.mG)(this,void 0,void 0,function*(){yield this.oAPIService.send2ServerP("exchange-bot-config/delete",!0,{ID:this.oSConfig.ID}).then(e=>(0,h.mG)(this,void 0,void 0,function*(){yield this.router.navigateByUrl("bot-list")}))})}onDeleteOutput(i){return(0,h.mG)(this,void 0,void 0,function*(){console.log(i),yield this.oAPIService.send2ServerPDelete("output/"+i.ID)})}getDecimalPlaces(i){const e=String(i);return e.includes(".")?e.split(".")[1].length:0}onShowOutput(i){return(0,h.mG)(this,void 0,void 0,function*(){this.oT=[],this.dMinPrice=Number.MAX_VALUE,yield this.oAPIService.send2ServerP("exchange-bot/logs"+i.ID).then(e=>(0,h.mG)(this,void 0,void 0,function*(){if(void 0===e||void 0===e.T)return;let r=e.T.length;this.dNetInvestment=0,this.dNetQuantity=0;for(var n=0;n<r;n++){if("FILLED"!=e.T[n].Status)continue;let d=e.T[n].D,S=this.getDecimalPlaces(e.T[n].Q),A=this.getDecimalPlaces(e.T[n].P);S=A<3?Math.min(S+A,7):Math.min(S,0),this.dMinPrice=Math.min(e.T[n].P),"S"==e.T[n].Dir?(e.T[n].Q=-1*e.T[n].Q,this.dNetInvestment+=e.T[n].P*e.T[n].Q*.998):this.dNetInvestment+=e.T[n].P*e.T[n].Q*1.002,this.dNetQuantity+=e.T[n].Q,this.oT.push({D:d,Q:e.T[n].Q.toFixed(S),P:e.T[n].P,$:Number(e.T[n].Q)*Number(e.T[n].P)})}if((""+this.dMinPrice).split("."),this.dMinPrice>=1e-4)this.leadingZeros=0;else{var g=this.dMinPrice.toFixed(18).replace(/\.?0+$/,"");this.leadingZeros=g.substring(0,g.lastIndexOf("0")+1).length-2,this.leadingZeros<3?this.leadingZeros=0:this.leadingZeros-=2}0!=this.dNetQuantity&&(this.dAvgPrice=this.dNetInvestment/this.dNetQuantity),this.dNetQuantity<0?(this.d3PctPrice=.97*this.dAvgPrice,this.d5PctPrice=.95*this.dAvgPrice):(this.d3PctPrice=1.03*this.dAvgPrice,this.d5PctPrice=1.05*this.dAvgPrice)}))})}onFormSubmit(i){return(0,h.mG)(this,void 0,void 0,function*(){this.bLoaded=!0;let e=Object.keys(i),r=e.length;for(var s=0;s<r;s++){var n=e[s],a=i[n];n.startsWith("PARAMS")&&(this.oSConfig.PARAMS[n.substring(7)]=a)}void 0===this.oSConfig.ID?yield this.oAPIService.send2ServerP("exchange-bot-config/insert",!0,{PARAMS:JSON.stringify(this.oSConfig.PARAMS)}):yield this.oAPIService.send2ServerP("exchange-bot-config/update",!0,{ID:this.oSConfig.ID,PARAMS:JSON.stringify(this.oSConfig.PARAMS)}),yield this.router.navigateByUrl("bot-list")})}}return o.\u0275fac=function(i){return new(i||o)(t.Y36(f.Ye),t.Y36(M.D),t.Y36(p.eN),t.Y36(m.F0),t.Y36(T.V))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-bot-setup"]],decls:11,vars:4,consts:[["slot","start"],["slot","end",4,"ngIf"],[1,"ion-padding"],[3,"jsonFormData","formSubmission"],[4,"ngIf"],["slot","end"],["name","trash",3,"click"],["item-end",""],[3,"click"],["name","albums","color","primary"],["color","primary"],["name","close","color","primary"],[1,"ion-margin"],[4,"ngFor","ngForOf"]],template:function(i,e){1&i&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t._uU(3),t.qZA(),t.TgZ(4,"ion-buttons",0),t._UZ(5,"ion-back-button"),t.qZA(),t.YNc(6,x,2,0,"div",1),t.qZA()(),t.TgZ(7,"ion-content",2)(8,"div")(9,"app-json-form",3),t.NdJ("formSubmission",function(s){return e.onFormSubmit(s)}),t.qZA()(),t.YNc(10,_,26,8,"div",4),t.qZA()),2&i&&(t.xp6(3),t.Oqu(e.sTitle),t.xp6(3),t.Q6J("ngIf",void 0!==e.oSConfig.ID),t.xp6(3),t.Q6J("jsonFormData",e.formData),t.xp6(1),t.Q6J("ngIf",void 0!==e.sKey))},dependencies:[f.sg,f.O5,c.oU,c.Sm,c.hM,c.wI,c.W2,c.jY,c.Gu,c.gu,c.Ie,c.Q$,c.Nd,c.sr,c.wd,c.cs,Z.u,f.uU],styles:["ion-col[_ngcontent-%COMP%]{text-align:right}ion-icon[_ngcontent-%COMP%]{margin:10px;font-size:large}"]}),o})()}];let B=(()=>{class o{}return o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[m.Bz.forChild(I),m.Bz]}),o})();var Q=l(5441);let b=(()=>{class o{}return o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[f.ez,v.UX,c.Pc,B,p.JF,Q.G]}),o})()}}]);